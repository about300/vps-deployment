name: Update Bing Background

on:
  schedule:
    - cron: "0 1 * * *"   # 每天 01:00 UTC（国内早上）
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-bing:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create assets directory
        run: |
          mkdir -p assets

      - name: Download Bing wallpaper
        run: |
          curl -s "https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=en-US" \
          | jq -r '.images[0].url' \
          | sed 's/^/https:\/\/www.bing.com/' \
          | xargs -I {} curl -L {} -o assets/bing.jpg

      - name: Commit and push if changed
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add assets/bing.jpg
          git diff --cached --quiet || git commit -m "update bing background"
          git push
